package de.daniel.marlinghaus.vidr.vulnerability.report;

import static org.assertj.core.api.Assertions.assertThat;
import static org.assertj.core.api.Assertions.assertThatCode;
import static org.assertj.core.api.Assertions.assertThatNoException;
import static org.junit.jupiter.api.Assertions.*;

import java.nio.file.Path;
import java.nio.file.Paths;
import org.junit.jupiter.api.Test;

class TrivyReportDeserializerTest {

  private final Path reportFile = Paths.get("src", "test", "resources",
      "vulnerability-sbom-test-local-bec7c176-06db-4d76-8247-6686b73d761d-trivy-report.json");

  @Test
  void deserializeTest() {

    assertThatCode(() -> {
      try (TrivyReportDeserializer trivyReportDeserializer = new TrivyReportDeserializer()) {
        var result = trivyReportDeserializer.deserialize(reportFile);

        assertThat(result).isNotNull();
        assertThat(result).hasNoNullFieldsOrProperties();
        assertThat(result.getVulnerabilities()).isNotEmpty();
        assertThat(result.getVulnerabilities().get(0).getGavDependency()).isNotNull();
        assertThat(result.getVulnerabilities().get(0).getGavDependency().getArtifact()).isEqualTo(
            "jackson-databind");
      }
    }).doesNotThrowAnyException();
  }
}
